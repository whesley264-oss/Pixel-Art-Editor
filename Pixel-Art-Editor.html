<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixel Art Editor</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");

* {margin:0;padding:0;box-sizing:border-box;font-family:"Inter",sans-serif;}
body {background-color:#212121;}
header {background-color:#292929;padding:0 15px;height:55px;display:flex;align-items:center;box-shadow:0 2px rgba(0,0,0,0.3);}
header>h1 {color:#ebebeb;font-weight:700;font-size:1.3rem;}
main {display:flex;gap:20px;align-items:flex-start;}
aside {width:100%;max-width:270px;background-color:#2c2c2c;padding:30px 20px 20px;min-height:calc(100vh - 55px);}
.canvas {width:100%;max-width:720px;margin-top:20px;display:flex;flex-direction:column;gap:2px;background-color:#555;}
.row {display:flex;gap:2px;}
.pixel {flex:1;aspect-ratio:1;background-color:#444;user-select:none;cursor:pointer;}
.option-title {color:#ebebeb;font-weight:600;display:block;margin-top:10px;}
.input-size, .input-color {margin:5px 0 15px;}
.input-size {width:100%;border:none;padding:10px;border-radius:4px;font-size:0.85rem;font-weight:700;color:#212121;outline:none;}
.input-color {appearance:none;width:42px;height:45px;border:none;border-radius:50px;cursor:pointer;}
.input-color::-moz-color-swatch {border-radius:50px;border:2px solid #ebebeb;}
.input-color::-webkit-color-swatch {border-radius:50px;border:2px solid #ebebeb;}
.used-colors {margin-top:10px;display:flex;gap:5px;flex-wrap:wrap;}
.button-color {width:40px;height:40px;border:none;border-radius:50%;cursor:pointer;}
.button-save, .button-action {width:100%;padding:10px;border:none;border-radius:5px;font-weight:600;font-size:0.85rem;margin-top:10px;cursor:pointer;background-color:#ebebeb;}
.button-save:hover, .button-action:hover {background-color:#d5d4d4;}
</style>
</head>
<body>
<header><h1>Pixel Art</h1></header>
<main>
<aside>
    <span class="option-title">Tamanho:</span>
    <input type="number" class="input-size" min="4" value="10">

    <span class="option-title">Cor:</span>
    <input type="color" class="input-color">

    <span class="option-title">Cores usadas:</span>
    <section class="used-colors"></section>

    <button class="button-action" id="brush">Borracha</button>
    <button class="button-action" id="undo">Desfazer</button>
    <button class="button-action" id="redo">Refazer</button>
    <button class="button-save" id="save">Baixar imagem</button>
</aside>
<section class="canvas"></section>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const canvas = document.querySelector(".canvas");
const inputSize = document.querySelector(".input-size");
const inputColor = document.querySelector(".input-color");
const usedColors = document.querySelector(".used-colors");
const brushBtn = document.getElementById("brush");
const undoBtn = document.getElementById("undo");
const redoBtn = document.getElementById("redo");
const saveBtn = document.getElementById("save");

let currentColor = inputColor.value;
let isPainting = false;
let isEraser = false;
let undoStack = [];
let redoStack = [];

function createElement(tag, className="") {
    const e = document.createElement(tag);
    if(className) e.className = className;
    return e;
}

function setPixelColor(pixel){
    const prevColor = pixel.style.backgroundColor;
    undoStack.push({pixel:pixel,prevColor:prevColor});
    redoStack=[];
    pixel.style.backgroundColor = isEraser ? "#444" : currentColor;

    // histórico de cores diferentes
    if(!isEraser && currentColor!="#444"){
        const saved = Array.from(usedColors.children);
        if(saved.every(b=>b.getAttribute("data-color")!==currentColor)){
            const btn = createElement("button","button-color");
            btn.style.backgroundColor = currentColor;
            btn.setAttribute("data-color",currentColor);
            btn.addEventListener("click", ()=>{
                currentColor = btn.getAttribute("data-color");
                inputColor.value = currentColor;
                isEraser=false;
            });
            usedColors.appendChild(btn);
        }
    }
}

function createPixel(){
    const pixel = createElement("div","pixel");
    pixel.addEventListener("mousedown",()=>setPixelColor(pixel));
    pixel.addEventListener("mouseover",()=>{if(isPainting)setPixelColor(pixel);});
    return pixel;
}

function loadCanvas(){
    const size = inputSize.value;
    canvas.innerHTML="";
    for(let i=0;i<size;i++){
        const row = createElement("div","row");
        for(let j=0;j<size;j++){
            row.appendChild(createPixel());
        }
        canvas.appendChild(row);
    }
}

// eventos
canvas.addEventListener("mousedown",()=>isPainting=true);
canvas.addEventListener("mouseup",()=>isPainting=false);
inputSize.addEventListener("change",loadCanvas);
inputColor.addEventListener("change",()=>{currentColor=inputColor.value;isEraser=false;});

// desfazer e refazer
function undo(){
    if(undoStack.length===0)return;
    const last = undoStack.pop();
    redoStack.push({pixel:last.pixel,prevColor:last.pixel.style.backgroundColor});
    last.pixel.style.backgroundColor = last.prevColor;
}
function redo(){
    if(redoStack.length===0)return;
    const last = redoStack.pop();
    undoStack.push({pixel:last.pixel,prevColor:last.pixel.style.backgroundColor});
    last.pixel.style.backgroundColor = last.prevColor;
}

// borracha
brushBtn.addEventListener("click",()=>isEraser=true);
undoBtn.addEventListener("click",undo);
redoBtn.addEventListener("click",redo);

// salvar imagem
saveBtn.addEventListener("click",()=>{
    let filename = prompt("Digite o nome do arquivo:", "pixelart");
    if(!filename) filename = "pixelart";
    html2canvas(canvas).then(c=>{
        const link=createElement("a");
        link.href=c.toDataURL("image/png");
        link.download=filename+".png";
        link.click();
    });
});

loadCanvas();
</script>
</body>
  </html>
  
